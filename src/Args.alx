import('sys');
from('ast', 'literal_eval');

class CliArgs {
    Mode: null,
    Get: null,
    Post: null,
};

class ParserState {
    Class: 0,
    Url: 1,
    Option: 2,
    OptionValue: 3,
};

class ClassOption {
    Lfi: '-lfi',
};

class ArgOption {
    Get: '-g',
    Post: '-p',
};

parseArgs = @{
    i = 0;
    key = null;
    state = ParserState.Class;
    obj = CliArgs();
    
    for (x in sys.argv @skip(1)) {
        switch (state) {
            ParserState.Class: {
                obj.Mode = x;
                state = ParserState.Url;
            }
            ParserState.Url: {
                obj.Url = x;
                state = ParserState.Option;
            }
            ParserState.Option: {
                key = x;
                state = ParserState.OptionValue;
            }
            ParserState.OptionValue: {
                switch (key) {
                    ArgOption.Get: obj.Get = literal_eval(x);
                    ArgOption.Post: obj.Post = literal_eval(x);
                }
                
                state = ParserState.Option;
            }
            default: {
                print('Error parsing argument: %s' % x);
                quit();
            }
        }
        
        i++;
    }
    
    ret obj;    
};

hasArgs = sys.argv |> len @> 1;
args = parseArgs();
data = dict();