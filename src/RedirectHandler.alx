import('urllib2');
from('urllib', 'addinfourl');
from('urllib2', 'HTTPRedirectHandler');

class HTTPRedirectHandler RedirectHandler {
    http_error_302: @(req, fp, code, msg, headers) {
        x = addinfourl(fp, headers, req.get_full_url());
        x.status = code;
        x.code = code;        
        ret x;
    },
    
    http_error_300: http_error_302,
    http_error_301: http_error_302,
    http_error_303: http_error_302,
    http_error_307: http_error_302,
};

RedirectHandler()
|> urllib2.build_opener
|> urllib2.install_opener;