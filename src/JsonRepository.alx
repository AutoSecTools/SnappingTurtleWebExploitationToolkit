import('json');

class init JsonRepository {
    repo = null,
    
    __init__: @(filename) {
        if (self.exists()) self.read();
        else self.repo = dict();
    },
    
    exists: @() self.filename |> File.exists,
    
    read: @{
        self.repo = self.filename |> File.readAllText |> json.loads;
        
        if (!isinstance(self.repo, dict)) {
            self.repo = dict();
        }
    },

    write: @{ self.repo |> json.dumps @File.writeAllText(self.filename) },
    
    add: @(key, obj) {
        self.repo[key] = obj;
        self.write();        
    },
    
    __getitem__: @(key) self.repo.get(key),
};